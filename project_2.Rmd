---
title: 'Reproducible Research: Peer Assessment 2'
---

## Synopsis
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

In this report we try to answer two questions: 
1) Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
2) Across the United States, which types of events have the greatest economic consequences?

## load neccesary packages
```{r load_packages, echo=TRUE}
library(ggplot2) # enhanced grahics
library(ggthemes) # advanced themese
library(reshape2)
library(lattice)
```


## Dataprocessing
```{r dataprocessing, echo=TRUE}

# download the zip file
download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", destfile="./repdata-data-StormData.csv.bz2", method="curl")


# read the csv from the zipfile
stormdata <- read.csv('./repdata-data-StormData.csv.bz2', header=T)

# examine which events (based on EVTYPE in the dataset) are the most harmful to population health. 
# we will make a difference between the number of injuries en the number of fatalities

# determine the number of injuries per event
injuries_per_event <- aggregate(stormdata$INJURIES, by=list(stormdata$EVTYPE), FUN=sum)
names(injuries_per_event) <- c("event","injuries")

# determine the number of fatalities per event
fatalities_per_event <- aggregate(stormdata$FATALITIES, by=list(stormdata$EVTYPE), FUN=sum)
names(fatalities_per_event) <- c("event","fatalities")

# merge the dataframes with injuries and fatalities
injuries_and_fatalities <- merge(x = fatalities_per_event, y = injuries_per_event, by = "event", all = TRUE)

# create a new column with the sum of the number of injuries and the number of fatalities
injuries_and_fatalities$total <- injuries_and_fatalities$injuries + injuries_and_fatalities$fatalities

# determine what is the top 10 of events with the most injuries and fatalities (combined)
top10_injuries_and_fatalities <- head(injuries_and_fatalities[order(injuries_and_fatalities$total,decreasing = T),],10)

# remove the total-column
top10_injuries_and_fatalities <- subset(top10_injuries_and_fatalities, select = c(event,injuries,fatalities) )

# reshape the dataframe to the columns: event, injury/fatality, count
top10_injuries_and_fatalities <- melt(top10_injuries_and_fatalities, id.vars = 'event')
names(top10_injuries_and_fatalities) <- c("Event", "fatality_injury", "Count")
```

## Results
```{r result, echo=TRUE}
ggplot(top10_injuries_and_fatalities, aes(x = Event, y = Count, fill = fatality_injury)) +
        geom_bar(stat = "identity") +    
        labs(fill="") +
        labs(x="", y="number of injuries and fatalities") + 
        ggtitle("Weather-related Fatality & Injury Counts")+
        coord_flip()
```
